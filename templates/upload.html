<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload Image — AccessiGo</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <nav class="navbar glass" id="navbar">
    <div class="navbar__left">
      <a class="logo" href="{{ url_for('index') }}">
        <img class="logo__img-square"
             src="{{ url_for('static', filename='img/logo.png') }}"
             alt="AccessiGo logo" />
        <span class="logo__text">AccessiGo</span>
      </a>
    </div>
    <div class="navbar__right">
      <a class="btn" href="{{ url_for('index') }}">Home</a>
      <a class="btn" href="https://github.com/Shmy1234/AccessiGo" target="_blank" rel="noopener noreferrer">GitHub Repo</a>
    </div>
  </nav>

  <main class="container one-col">
    <section class="card">
      <h1>Upload an Entrance Photo</h1>
      <p class="muted">Supported formats: PNG, JPG, JPEG, GIF, BMP (max 16MB)</p>

      <form id="uploadForm" class="upload-form" action="{{ url_for('upload_file') }}" method="POST" enctype="multipart/form-data">
        <label for="file" class="file-drop" id="fileDrop">
          <input id="file" name="file" type="file" accept="image/*" hidden />
          <span>Drag &amp; drop image here or click to browse</span>
        </label>
        <button class="btn btn--primary" id="submitButton" type="submit">Upload</button>
      </form>

      <div id="preview" class="preview hidden">
        <img id="previewImg" alt="Preview" />
      </div>

      <div id="result" class="result hidden" role="status" aria-live="polite">
        <div class="result__icon" id="resultIcon" aria-hidden="true">?</div>
        <div class="result__text">
          <h2 id="resultLabel">Result</h2>
          <p id="resultScore">Score: —</p>
          <p id="resultDescription" class="muted"></p>
        </div>
        <button class="btn" id="resetButton" type="button">Upload another image</button>
      </div>
    </section>
  </main>

  <footer class="footer glass">
    <p>
      Built by
      <a href="https://www.linkedin.com/in/sahilregonda/" target="_blank" rel="noopener noreferrer">Sahil</a> ·
      <a href="https://github.com/ThatJack" target="_blank" rel="noopener noreferrer">Jack</a> ·
      <a href="https://www.linkedin.com/in/vaamanan-mugunthan-93202a32b/" target="_blank" rel="noopener noreferrer">Vaamanan</a>
    </p>
  </footer>

  <script>
    // Navbar shrink on scroll
    const navbar = document.getElementById('navbar');
    function updateNavbar() {
      if (window.scrollY > 10) navbar.classList.add('navbar--shrink');
      else navbar.classList.remove('navbar--shrink');
    }
    window.addEventListener('scroll', updateNavbar, { passive: true });
    document.addEventListener('DOMContentLoaded', updateNavbar);

    // Upload logic
    const fileInput = document.getElementById('file');
    const fileDrop = document.getElementById('fileDrop');
    const form = document.getElementById('uploadForm');
    const preview = document.getElementById('preview');
    const previewImg = document.getElementById('previewImg');
    const result = document.getElementById('result');
    const resultIcon = document.getElementById('resultIcon');
    const resultLabel = document.getElementById('resultLabel');
    const resultScore = document.getElementById('resultScore');
    const resultDescription = document.getElementById('resultDescription');
    const resetButton = document.getElementById('resetButton');

    fileDrop.addEventListener('click', () => fileInput.click());
    fileDrop.addEventListener('dragover', (e) => { e.preventDefault(); fileDrop.classList.add('file-drop--active'); });
    fileDrop.addEventListener('dragleave', () => fileDrop.classList.remove('file-drop--active'));
    fileDrop.addEventListener('drop', (e) => {
      e.preventDefault();
      fileDrop.classList.remove('file-drop--active');
      const files = e.dataTransfer.files;
      if (files && files[0]) { fileInput.files = files; showPreview(files[0]); }
    });
    fileInput.addEventListener('change', () => {
      if (fileInput.files && fileInput.files[0]) showPreview(fileInput.files[0]);
    });

    function showPreview(file) {
      preview.classList.remove('hidden');
      const reader = new FileReader();
      reader.onload = (e) => (previewImg.src = e.target.result);
      reader.readAsDataURL(file);
      previewImg.classList.remove('border--green','border--yellow','border--red');
      result.classList.remove('result--green','result--yellow','result--red');
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const res = await fetch(form.action, { method: 'POST', body: formData });
      const data = await res.json();

      if (data.error) {
        resultLabel.textContent = 'Error';
        resultScore.textContent = data.error;
        resultIcon.textContent = '⚠';
        resultDescription.textContent = '';
        result.classList.remove('hidden');
        return;
      }

      const score = typeof data.score === 'number' ? data.score : 0;
      resultScore.textContent = 'Score: ' + score.toFixed(2);

      function setTint(which) {
        result.classList.remove('result--green','result--yellow','result--red');
        result.classList.add('result--' + which);
      }
      function setBorder(which) {
        previewImg.classList.remove('border--green','border--yellow','border--red');
        previewImg.classList.add('border--' + which);
      }

      if (score <= 0.4) {
        resultLabel.textContent = 'Accessible (green)';
        resultDescription.textContent = '(green) perfectly accessible';
        resultIcon.textContent = '✓';
        setBorder('green');
        setTint('green');
      } else if (score < 0.6) {
        resultLabel.textContent = 'Somewhat Accessible (yellow)';
        resultDescription.textContent = '(yellow) somewhat accessible';
        resultIcon.textContent = '✓';
        setBorder('yellow');
        setTint('yellow');
      } else {
        resultLabel.textContent = 'Inaccessible (red)';
        resultDescription.textContent = '(red) HORRIBLE for disabled people';
        resultIcon.textContent = '✗';
        setBorder('green');   // as requested
        setTint('red');       // frosted red result card
      }

      result.classList.remove('hidden');
      preview.classList.add('preview--show');
    });

    resetButton.addEventListener('click', () => {
      form.reset();
      preview.classList.add('hidden');
      preview.classList.remove('preview--show');
      result.classList.add('hidden');
      previewImg.classList.remove('border--green','border--yellow','border--red');
      result.classList.remove('result--green','result--yellow','result--red');
    });
  </script>
</body>
</html>
